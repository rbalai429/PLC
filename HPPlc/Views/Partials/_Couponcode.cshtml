@inherits Umbraco.Web.Mvc.UmbracoViewPage

@{
	var titleText = Umbraco?.ContentAtRoot()?.Where(x => x.ContentType.Alias == "home")?.FirstOrDefault()?.DescendantsOrSelf()?
				.Where(x => x.ContentType.Alias == "bonusBuyNow")?.OfType<BonusBuyNow>()?.FirstOrDefault();

	var couponCodeAvailedData = HPPlc.Models.SessionManagement.GetCurrentSession<HPPlc.Models.Coupon.CouponCodeResponse>(HPPlc.Models.SessionType.CouponTempDtls);

	string CouponCode = HPPlc.Models.SessionManagement.GetCurrentSession<string>(HPPlc.Models.SessionType.CouponCode);

	decimal totalPayableAmount = 0;
	decimal totalSubscriptionAmount = 0;
	decimal existingUserDiscountedAmount = 0;
	decimal CouponDiscountAmount = 0;
	//decimal SubscriptionDiscountAmount = 0;

	HPPlc.Models.SubscriptionAmountCalc subscriptionAmountCalc = new HPPlc.Models.SubscriptionAmountCalc();
	CouponDiscountAmount = subscriptionAmountCalc.GetCouponDiscountAmount();

	existingUserDiscountedAmount = subscriptionAmountCalc.GetExistingUserDiscountAmount();
	totalSubscriptionAmount = subscriptionAmountCalc.GetSubscriptionAmount();
	totalPayableAmount = subscriptionAmountCalc.GetPayableAmount();
	//SubscriptionDiscountAmount = subscriptionAmountCalc.GetDiscountAmount();

}

<div class="duc-top">
	<p>@titleText.DoYouHaveAcouponTitle</p>
	@*<span><img src="/common/images/coupon-slide.jpg"></span>*@
</div>
<div class="couponbox">
	<div class="open-inner">
		<input type="text" id="couponCode" name="couponCode" maxlength="15" value="@CouponCode" placeholder="@titleText.CouponPlaceholder" />
		@*value="@(couponCodeAvailedData == null ? CouponCode :couponCodeAvailedData?.CouponCodeName)"*@

		<button type="button" id="btnCouponAvail" class="btn" onclick="CouponCodeCheck();">@titleText.CouponApplyButton</button>
	</div>
</div>

<div>
	<span class="error" id="couponmessage" style="display:none;"></span>
</div>

@if (couponCodeAvailedData != null)
{
	if (couponCodeAvailedData != null && couponCodeAvailedData.ResponseCode == 1)
	{
		<div class="submonth-fix error">
			@titleText.TotalCouponDiscountAmt   ₹@CouponDiscountAmount
		</div>

		<div class="calcel-format">
			<a class="sbcptn-btn" href="javascript:void(0)" onclick="BonusCancelCouponCode();">@titleText.CouponCancelText</a>
		</div>
	}
	else //if(!String.IsNullOrEmpty(couponCodeAvailedData?.CouponCodeName))
	{
		<div class="error">
			@if (!couponCodeAvailedData.ResponseMessage.Equals("Printer serial no./coupon code validity expired"))
			{
				<p id="messageboxbonus">@Html.Raw(couponCodeAvailedData.ResponseMessage)</p>
			}

			@{
				couponCodeAvailedData.ResponseMessage = "";
				HPPlc.Models.SessionManagement.StoreInSession(HPPlc.Models.SessionType.CouponTempDtls, couponCodeAvailedData);
			}
		</div>
	}
}

