@inherits Umbraco.Web.Mvc.UmbracoViewPage<HPPlc.Models.WorkSheet.WorkSheetItems>
@using HPPlc.Models.WorkSheet;
@using System.Globalization;

@{
	var model = Model;
	string pageName = HPPlc.Models.GetPageName.pagename();

	bool UserLoggedInOrNot = HPPlc.Models.SessionExpireAttribute.UserLoggedIn();
}

@if (model != null && Model.NestedItems != null && Model.NestedItems.Any())
{
	<input type="hidden" id="selectedSubjects" value="@Model.selectedSubjectsForSearch" />
	<input type="hidden" id="CbseContentChecked" value="@Model.CbseContentCheckedForSearch" />
	@*<div class="list-items">*@
	<div class="video-tutorials">
		@*<div class="title-fltr-fix">
				<div>
					<h3> @Model.Title</h3>
				</div>
			</div>*@
		@*@if (Model.Description != null)
			{
				IHtmlString description = Model.Description;

				<div class="title-fltr-fix">
					<div class="descTitle">
						@Html.Raw("<p>" + description.ToHtmlString().Replace("<p>", "").Replace("</p>", "") + "  <a href='javascript: void(0);' onclick='gotobottomfaq();'>" + model.ReadMore + "</a>" + "</p>")
					</div>
				</div>
			}*@


		<div class="recommended-list">
			<div class="list-items">
				@foreach (NestedItems nested in Model?.NestedItems)
				{
					var detailData = string.Empty;
					if (!string.IsNullOrEmpty(nested.Title))
					{
						detailData = nested.Title;
					}
					if (!string.IsNullOrEmpty(nested.Volume))
					{
						detailData = detailData + "-" + nested.Volume;
					}
					if (!string.IsNullOrEmpty(nested.Category))
					{
						detailData = detailData + "-" + nested.Subject;
					}
					<div class='item-col'>
						<div class='card-box'>
							<div class='card-img'>
								<div class="cardImgPlchldr">
									<picture>
										@if (!String.IsNullOrWhiteSpace(nested.MobileImagesSrc))
										{
											<source class='b-lazy' alt="@nested.MobileAltText" data-src="@nested.MobileImagesSrc" src="/common/images/img-loader.gif" media="(max-width: 680px)" />
										}

										@if (!String.IsNullOrWhiteSpace(nested.MobileNextGenImage))
										{
											<source data-srcset="@nested.MobileNextGenImage" srcset="/common/images/img-loader.gif" type='image/webp' media="(max-width: 680px)" />
										}

										@if (!String.IsNullOrWhiteSpace(nested.NextGenImage))
										{
											<source data-srcset="@nested.NextGenImage" srcset="/common/images/img-loader.gif" type='image/webp' />
										}

										@if (!String.IsNullOrWhiteSpace(nested.ImagesSrc))
										{
											<img class='b-lazy imgPlacing' alt="@nested.AltText" src='/common/images/img-loader.gif' data-src='@nested.ImagesSrc' width="200" height="200" />
										}
									</picture>
								</div>
								@if (nested.IsQuizWorksheet == true)
								{
									<a href="javascript:void(0);" class="quizLabl">Quiz</a>
								}
								@if (nested.IsEnabledForDetailsPage == true)
								{
									<a href="@nested.WorksheetDetailsUrl" class="prevOverlyBx" onclick="commonLayer('@pageName','@(detailData + "- Worksheet Details Page")');">
										<span><img src="/common/images/icon-pdf.png" width="1" height="1" alt=""> Click to see details</span>
									</a>
								}
								else if (nested.IsEnabledForDetailsPage == false && !String.IsNullOrWhiteSpace(nested.PreviewPdf))
								{
									<a href="@nested.PreviewPdf" target="_blank" class="prevOverlyBx" onclick="commonLayer('@pageName','@(detailData + "-PreviewPDF")');">
										<span><img src="/common/images/icon-pdf.png" width="1" height="1" alt=""> Click to see worksheets</span>
									</a>
								}
							</div>
							<div class='card-cont'>
								<div class="card-dscptn">
									@*<div class="card-title">@nested.Title</div>*@
									@nested.Description
								</div>
								@{
									string pageTitle = model.PageTitle;
								}

								@if (nested.subscriptionStatus != null)
								{
									if (nested.subscriptionStatus.Condition1 || nested.subscriptionStatus.Condition3 || nested.subscriptionStatus.Condition4 || nested.subscriptionStatus.Condition5)
									{
										if (nested.socialItems != null && (nested.socialItems.FBShare != null || nested.socialItems.EmailShare != null || nested.socialItems.WhatAppShare != null))
										{
											<div class='print-col'><a class='clsPrintDoc'><span style='display:none;'>@nested.subscriptionStatus.DownloadString</span><span style='display:none'>@detailData</span><span style='display:none'>@pageTitle</span></a></div>
											var detailShareData = string.Empty;
											if (!string.IsNullOrEmpty(nested.Title))
											{
												detailShareData = nested.Title;
											}
											if (!string.IsNullOrEmpty(nested.Volume))
											{
												detailShareData = detailShareData + "-" + nested.Volume;
											}
											if (!string.IsNullOrEmpty(nested.Description.ToString()))
											{
												System.Text.RegularExpressions.Regex rx = new System.Text.RegularExpressions.Regex("<[^>]*>");
												string dtls = rx.Replace(nested.Description.ToString(), "").Replace("\n", "");

												detailShareData = detailShareData + "-" + dtls;
											}

											<div class='card-social-icon'>
												<div class='share-icon'>
													<div class='share-box'>
														<ul>
															@if (nested.socialItems.FBShare != null)
															{
																<li><a href='javascript:void(0)' class='fb-icon aFBShare' onclick="commonShareLayer('Share_facebook','@detailShareData');"><span style='display:none'>@nested.socialItems.FBShare</span></a></li>
															}
															@if (nested.socialItems.WhatAppShare != null)
															{
																<li>
																	<a href='javascript:void(0)' class='whatsapp-icon aWHTAppSH' onclick="commonShareLayer('Share_whatsapp','@detailShareData');">
																		<span style='display:none'>
																			@nested.socialItems.WhatAppShare
																		</span>
																	</a>
																</li>
															}
															@if (nested.socialItems.EmailShare != null)
															{
																<li>
																	<a href='javascript:void(0)' class='mail-icon aMailSh' onclick="commonShareLayer('Share_mail','@detailShareData');">
																		<span style='display:none'>
																			@nested.socialItems.EmailShare
																		</span>
																	</a>
																</li>
															}
														</ul>
													</div>
												</div>
											</div>
										}
									}
								}
									</div>
							<div class='card-btn-print'>
								@if (nested.subscriptionStatus != null)
								{
									string culture = HPPlc.Models.CultureName.GetCultureName().Replace("/", "");
									if (String.IsNullOrWhiteSpace(culture))
									{ culture = "en-US"; }

									System.Threading.Thread.CurrentThread.CurrentUICulture = new CultureInfo(culture);

									string downloadButton = String.Empty;
									if (UserLoggedInOrNot == true)
									{
										downloadButton = Umbraco.GetDictionaryValue("Download Button");
									}
									else
									{
										downloadButton = Umbraco.GetDictionaryValue("FreeDownload");
									}

									string subscribeToDownload = Umbraco.GetDictionaryValue("Subscribe to download");
									string upgradeToPremium = Umbraco.GetDictionaryValue("Upgrade to Premium");
									string buyNewSubscription = Umbraco.GetDictionaryValue("BuyNewSubscription");

									string classForQuiz = "btn-full";
									if (nested.IsQuizWorksheet == true)
									{
										classForQuiz = "btn-half";
									}

									if (nested.subscriptionStatus.Condition1)
									{
										<div class='btn-col @classForQuiz'>
											<a href="@nested.subscriptionStatus.DownloadUrl" class='btn downllink' onclick="return addDownloadDataLayer('@detailData','@downloadButton','@pageTitle');">@downloadButton <span class='download-icon'></span></a>
										</div>
										@*<div class='print-col'><a class='clsPrintDoc'><span style='display:none;'>@nested.subscriptionStatus.DownloadString</span><span style='display:none'>@detailData</span><span style='display:none'>@pageTitle</span></a></div>*@
									}
									//2. if user not loggedin and worksheet not mapped with isguestuser true
									else if (nested.subscriptionStatus.Condition2)
									{
										<div class='btn-col @classForQuiz'>
											<a href="javascript:void(0)" class='btn subs-downllink' onclick="addSubscribeDataLayer('@detailData','@subscribeToDownload','@nested.subscriptionStatus.SubscriptionUrl','@pageTitle');">@subscribeToDownload <span class='download-icon'></span></a>
											@*<a href="javascript:void(0)" class='btn subs-downllink' onclick="return SubscriptionChange('@detailData','@subscribeToDownload','@nested.subscriptionStatus.SubscriptionUrl','@pageName')">@subscribeToDownload <span class='download-icon'></span></a>*@
											@*<span style='display:none'>@nested.subscriptionStatus.SubscriptionUrl</span>*@
										</div>
									}
									// 3.1 if User have free subscription and have referral
									else if (nested.subscriptionStatus.Condition3)
									{
										<div class='btn-col @classForQuiz'>
											<a href="@nested.subscriptionStatus.DownloadUrl" class='btn downllink' onclick="return addDownloadDataLayer('@detailData','@downloadButton','@pageTitle');"> @downloadButton<span class='download-icon'></span></a>
										</div>
										@*<div class='print-col'><a class='clsPrintDoc'><span style='display:none;'>@nested.subscriptionStatus.DownloadString</span><span style='display:none'>@detailData</span><span style='display:none'>@pageTitle</span></a></div>*@
									}
									// 3.2 if User have loggedin and age group is same with worksheet and worksheet is free
									else if (nested.subscriptionStatus.Condition4)
									{
										<div class='btn-col @classForQuiz'>
											<a href="@nested.subscriptionStatus.DownloadUrl" class='btn downllink' onclick="return addDownloadDataLayer('@detailData','@downloadButton','@pageTitle');"> @downloadButton <span class='download-icon'></span></a>
										</div>
										@*<div class='print-col'><a class='clsPrintDoc'><span style='display:none;'>@nested.subscriptionStatus.DownloadString</span><span style='display:none'>@detailData</span><span style='display:none'>@pageTitle</span></a></div>*@
									}
									else if (nested.subscriptionStatus.Condition5)
									{
										<div class='btn-col @classForQuiz'>
											<a href="@nested.subscriptionStatus.DownloadUrl" class='btn downllink' onclick="return addDownloadDataLayer('@detailData','@downloadButton','@pageTitle');"> @downloadButton <span class='download-icon'></span></a>
										</div>
										@*<div class='print-col'><a class='clsPrintDoc'><span style='display:none;'>@nested.subscriptionStatus.DownloadString</span><span style='display:none'>@detailData</span><span style='display:none'>@pageTitle</span></a></div>*@
									}
									else if (nested.subscriptionStatus.Condition6)
									{
										<div class='btn-col @classForQuiz'>
											<a href="javascript:void(0)" class='btn subs-downllink' onclick="addSubscribeDataLayer('@detailData','@upgradeToPremium','@nested.subscriptionStatus.SubscriptionUrl','@pageTitle');"> @upgradeToPremium <span class='download-icon'></span></a>
											@*<a href="javascript:void(0)" class='btn subs-downllink' onclick="return SubscriptionChange('@detailData','@upgradeToPremium','@nested.subscriptionStatus.SubscriptionUrl','@pageName')">@upgradeToPremium <span class='download-icon'></span></a>*@
											@*<span style='display:none'>@nested.subscriptionStatus.SubscriptionUrl</span>*@
										</div>
									}
									else if (nested.subscriptionStatus.Condition7)
									{
										<div class='btn-col @classForQuiz'>
											<a href="javascript:void(0)" class='btn subs-downllink' onclick="addSubscribeDataLayer('@detailData','@buyNewSubscription','@nested.subscriptionStatus.SubscriptionUrl','@pageTitle');"> @buyNewSubscription <span class='download-icon'></span></a>
											@*<a href="javascript:void(0)" class='btn subs-downllink' onclick="return SubscriptionChange('@detailData','@buyNewSubscription','@nested.subscriptionStatus.SubscriptionUrl','@pageName')">@buyNewSubscription <span class='download-icon'></span></a>*@
											@*<span style='display:none'>@nested.subscriptionStatus.SubscriptionUrl</span>*@
										</div>
									}
									else if (nested.subscriptionStatus.Condition8)
									{
										<div class='btn-col @classForQuiz'>
											<a href="javascript:void(0)" class='btn subs-downllink' onclick="addSubscribeDataLayer('@detailData','@buyNewSubscription','@nested.subscriptionStatus.SubscriptionUrl','@pageTitle');"> @buyNewSubscription <span class='download-icon'></span></a>
											@*<a href="javascript:void(0)" class='btn subs-downllink' onclick="return SubscriptionChange('@detailData','@buyNewSubscription','@nested.subscriptionStatus.SubscriptionUrl','@pageName')">@buyNewSubscription <span class='download-icon'></span></a>*@
											@*<span style='display:none'>@nested.subscriptionStatus.SubscriptionUrl</span>*@
										</div>
									}
									else if (nested.subscriptionStatus.Condition9)
									{
										<div class='btn-col @classForQuiz'>
											<a href="javascript:void(0)" class='btn subs-downllink' onclick="addSubscribeDataLayer('@detailData','@buyNewSubscription','@nested.subscriptionStatus.SubscriptionUrl','@pageTitle');"> @buyNewSubscription <span class='download-icon'></span></a>
											@*<a href="javascript:void(0)" class='btn subs-downllink' onclick="return SubscriptionChange('@detailData','@buyNewSubscription','@nested.subscriptionStatus.SubscriptionUrl','@pageName')">@buyNewSubscription <span class='download-icon'></span></a>*@
											@*<span style='display:none'>@nested.subscriptionStatus.SubscriptionUrl</span>*@
										</div>
									}
									else if (nested.subscriptionStatus.Condition10)
									{
										<div class='btn-col @classForQuiz'>
											<a href="javascript:void(0)" class='btn subs-downllink dvdatalayer' onclick="addSubscribeDataLayer('@detailData','@subscribeToDownload','@nested.subscriptionStatus.SubscriptionUrl','@pageName');">@subscribeToDownload <span class='download-icon'></span></a>
											@*<a href="javascript:void(0)" class='btn subs-downllink dvdatalayer' onclick="return SubscriptionChange('@detailData','@subscribeToDownload','@nested.subscriptionStatus.SubscriptionUrl','@pageName')">@subscribeToDownload <span class='download-icon'></span></a>*@
										</div>
									}
									else
									{
										<div class='btn-col @classForQuiz'>
											<a href="javascript:void(0)" class='btn subs-downllink' onclick="addSubscribeDataLayer('@detailData','@buyNewSubscription','@nested.subscriptionStatus.SubscriptionUrl','@pageTitle');"> @buyNewSubscription <span class='download-icon'></span></a>
											@*<a href="javascript:void(0)" class='btn subs-downllink' onclick="return SubscriptionChange('@detailData','@buyNewSubscription','@nested.subscriptionStatus.SubscriptionUrl','@pageName')">@buyNewSubscription <span class='download-icon'></span></a>*@
											@*<span style='display:none'>@nested.subscriptionStatus.SubscriptionUrl</span>*@
										</div>
									}

									if (nested.IsQuizWorksheet == true)
									{
										<div class="btn-col @classForQuiz">
											<a href="" class="btn secndryBtn downllink">Launch Quiz <span class="download-icon"></span></a>
										</div>
									}
								}
							</div>
						</div>
					</div>
				}
			</div>
		</div>
		<input type="hidden" name="DisplayCount" id="DisplayCount" value="@Model.LoadMore" />
		@if (Model.LoadMore > 0)
		{
			<div class="load-more" id="worksSheetByIdLoadMore"><a href="javascript:void(0);"></a></div>
		}
		@*</div>*@
	</div>

}
else
{
	<div class='fit-hd' style="text-align:center"><h5>@Umbraco.GetDictionaryValue("No Result Found", "No Result Found")</h5></div>
}