@inherits Umbraco.Web.Mvc.UmbracoViewPage<HPPlc.Models.WorkSheet.WorkSheetModel>
@using HPPlc.Models.WorkSheet;

@if (Model != null && Model.WorkSheets != null)
{
	string pageName = HPPlc.Models.GetPageName.pagename();
	try
	{
		foreach (var items in Model.WorkSheets)
		{
			<div class="video-tutorials">
				@if (!String.IsNullOrWhiteSpace(items.Title))
					{
						<div class="rowPlc rowPlcfull">
							<div class="fit-hd">
								<h2 class="hdtitl"> @items.Title</h2>
							</div>
						</div>
					}

				@if (items.NestedItems != null)
				{

					string downloadButton = Umbraco.GetDictionaryValue("Download Button");
					var freeDownloadButton = Umbraco.GetDictionaryValue("FreeDownload");
					string subscribeToDownloadButton = Umbraco.GetDictionaryValue("Subscribe to download");
					string loggedInOrNot = HPPlc.Models.SessionManagement.GetCurrentSession<string>(HPPlc.Models.SessionType.IsLoggedIn);
					string loginUrl = "/my-account/login";

					<div class="recommended-list">
						<div class="list-items dvWorksheetDetailsContainer">
							@foreach (NestedItems nested in items?.NestedItems)
							{
								var detailData = string.Empty;
								detailData = nested.Title;

								<div class='item-col'>
									<div class='card-box'>
										<div class='card-img'>
											<picture>
												@if (!String.IsNullOrWhiteSpace(nested.MobileImagesSrc))
												{
													<source class='b-lazy' alt="@nested.MobileAltText" data-src="@nested.MobileImagesSrc" src="/common/images/img-loader.gif" media="(max-width: 680px)" />
												}

												@if (!String.IsNullOrWhiteSpace(nested.MobileNextGenImage))
												{
													<source data-srcset="@nested.MobileNextGenImage" srcset="/common/images/img-loader.gif" type='image/webp' media="(max-width: 680px)"  />
												}

												@if (!String.IsNullOrWhiteSpace(nested.NextGenImage))
												{
													<source data-srcset="@nested.NextGenImage" srcset="/common/images/img-loader.gif" type='image/webp' />
												}

												@if (!String.IsNullOrWhiteSpace(nested.ImagesSrc))
												{
													<img class='b-lazy' alt="@nested.AltText" src='/common/images/img-loader.gif' data-src='@nested.ImagesSrc' width="200" height="200" />
												}
											</picture>
										</div>
										<div class='card-cont'>
											<div class="card-dscptn">
												@if (!String.IsNullOrWhiteSpace(nested.Title))
												{
													<div class="card-title">@nested.Title</div>
												}

												@Html.Raw(nested.Description)


											</div>

											@if (nested.socialItems != null && (nested.socialItems.FBShare != null || nested.socialItems.EmailShare != null || nested.socialItems.WhatAppShare != null))
											{
												<div class='print-col'><a class='clsPrintDoc'><span style='display:none;'>@nested.subscriptionStatus.DownloadString</span><span style='display:none'>@detailData</span><span style='display:none'>@pageName</span></a></div>
												var detailShareData = string.Empty;
												if (!string.IsNullOrEmpty(nested.Title))
												{
													detailShareData = nested.Title;
												}
												if (!string.IsNullOrEmpty(nested.Volume))
												{
													detailShareData = detailShareData + "-" + nested.Volume;
												}
												if (!string.IsNullOrEmpty(nested.Description.ToString()))
												{
													System.Text.RegularExpressions.Regex rx = new System.Text.RegularExpressions.Regex("<[^>]*>");
													string dtls = rx.Replace(nested.Description.ToString(), "").Replace("\n", "");

													detailShareData = detailShareData + "-" + dtls;
												}
												<div class='card-social-icon'>
													<div class='share-icon'>
														<div class='share-box'>
															<ul>
																@if (nested.socialItems.FBShare != null)
																{
																	<li><a href='javascript:void(0)' class='fb-icon aFBShare' onclick="commonShareLayer('Share_facebook','@detailShareData');"><span style='display:none'>@nested.socialItems.FBShare</span></a></li>
																}
																@if (nested.socialItems.WhatAppShare != null)
																{
																	<li>
																		<a href='javascript:void(0)' class='whatsapp-icon aWHTAppSH' onclick="commonShareLayer('Share_whatsapp','@detailShareData');">
																			<span style='display:none'>
																				@nested.socialItems.WhatAppShare
																			</span>
																		</a>
																	</li>
																}
																@if (nested.socialItems.EmailShare != null)
																{
																	<li>
																		<a href='javascript:void(0)' class='mail-icon aMailSh' onclick="commonShareLayer('Share_mail','@detailShareData');">
																			<span style='display:none'>
																				@nested.socialItems.EmailShare
																			</span>
																		</a>
																	</li>
																}
															</ul>
														</div>
													</div>
												</div>
											}

										</div>
										<div class='card-btn-print'>
											@if ((nested.IsAppliedforLoggedInUserOnly == true && loggedInOrNot == "Y"))
											{
												<div class='btn-col btn-ful'>
													<a href="@(nested.subscriptionStatus?.DownloadUrl)" class='btn downllink' onclick="return addDownloadDataLayer('@detailData','@downloadButton','@loginUrl','@pageName');">@downloadButton <span class='download-icon'></span></a>
												</div>
												@*<div class='print-col'><a class='clsPrintDoc'><span style='display:none;'>@(nested.subscriptionStatus?.DownloadString)</span><span style='display:none'>@detailData</span></a></div>*@
											}
											else if (nested.IsAppliedforLoggedInUserOnly == true && String.IsNullOrEmpty(loggedInOrNot))
											{
												<div class='btn-col btn-ful'>
													<a href="@loginUrl" class='btn subs-downllink dvdatalayer' onclick="return addDownloadDataLayer('@detailData','@subscribeToDownloadButton','@loginUrl','@pageName');">@subscribeToDownloadButton <span class='download-icon'></span></a>
												</div>
											}
											else if (nested.IsAppliedforLoggedInUserOnly == false)
											{
												<div class='btn-col btn-ful'>
													<a href="@(nested.subscriptionStatus?.DownloadUrl)" class='btn downllink' onclick="return addSubscribeDataLayer('@detailData','@downloadButton','','@pageName');">@downloadButton <span class='download-icon'></span></a>
												</div>
												@*<div class='print-col'><a class='clsPrintDoc'><span style='display:none;'>@(nested.subscriptionStatus?.DownloadString)</span><span style='display:none'>@detailData</span></a></div>*@
											}
										</div>
									</div>
								</div>
							}
						</div>
					</div>


				}

				@if (Model.WorkSheets != null && Model.WorkSheets.Count > 0)
				{
					var worksheetCnt = Model?.WorkSheets?.FirstOrDefault()?.NestedItems.Count();
					<input type="hidden" name="DisplayCount" id="DisplayCount" value="@worksheetCnt" />
				}

				@if (Model.LoadMore > 0)
				{
					<div class="load-more" id="worksSheetByIdLoadMore"><a href="javascript:void(0);"></a></div>
				}
			</div>
		}
	}
	catch { }
}
